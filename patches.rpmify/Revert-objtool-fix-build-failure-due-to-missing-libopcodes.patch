From: Pedro Falcato <pfalcato@suse.de>
Date: Wed, 21 Jan 2026 14:52:13 +0000
Subject: Revert "objtool: fix build failure due to missing libopcodes check"
Patch-mainline: Never, temporary build fix for tumbleweed
References: none

This reverts commit 436326bc525d467e38db1da576139ec5f28268c5.

Signed-off-by: Pedro Falcato <pfalcato@suse.de>
---
 tools/objtool/Makefile | 24 ++++++++++--------------
 1 file changed, 10 insertions(+), 14 deletions(-)

diff --git a/tools/objtool/Makefile b/tools/objtool/Makefile
index 9b4503113ce5..ad6e1ec706ce 100644
--- a/tools/objtool/Makefile
+++ b/tools/objtool/Makefile
@@ -72,27 +72,23 @@ HOST_OVERRIDES := CC="$(HOSTCC)" LD="$(HOSTLD)" AR="$(HOSTAR)"
 
 #
 # To support disassembly, objtool needs libopcodes which is provided
-# with libbfd (binutils-dev or binutils-devel package).
+# with libbdf (binutils-dev or binutils-devel package).
 #
-# We check using HOSTCC directly rather than the shared feature framework
-# because objtool is a host tool that links against host libraries.
-#
-HAVE_LIBOPCODES := $(shell echo 'int main(void) { return 0; }' | \
-			$(HOSTCC) -xc - -o /dev/null -lopcodes 2>/dev/null && echo y)
+FEATURE_USER = .objtool
+FEATURE_TESTS = libbfd disassembler-init-styled
+FEATURE_DISPLAY =
+include $(srctree)/tools/build/Makefile.feature
 
-# Styled disassembler support requires binutils >= 2.39
-HAVE_DISASM_STYLED := $(shell echo '$(pound)include <dis-asm.h>' | \
-			$(HOSTCC) -E -xc - 2>/dev/null | grep -q disassembler_style && echo y)
+ifeq ($(feature-disassembler-init-styled), 1)
+	OBJTOOL_CFLAGS += -DDISASM_INIT_STYLED
+endif
 
 BUILD_DISAS := n
 
-ifeq ($(HAVE_LIBOPCODES),y)
+ifeq ($(feature-libbfd),1)
 	BUILD_DISAS := y
-	OBJTOOL_CFLAGS += -DDISAS -DPACKAGE='"objtool"'
+	OBJTOOL_CFLAGS += -DDISAS -DPACKAGE="objtool"
 	OBJTOOL_LDFLAGS += -lopcodes
-ifeq ($(HAVE_DISASM_STYLED),y)
-	OBJTOOL_CFLAGS += -DDISASM_INIT_STYLED
-endif
 endif
 
 export BUILD_DISAS

