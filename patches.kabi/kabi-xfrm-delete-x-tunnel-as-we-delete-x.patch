From: Fernando Fernandez Mancera <fmancera@suse.de>
Subject: kABI: xfrm: delete x->tunnel as we delete x
Patch-mainline: Never, kABI workaround
References: bsc#1254959 CVE-2025-40215

Export xfrm_state_delete_tunnel() function again.


Signed-off-by: Fernando Fernandez Mancera <fmancera@suse.de>
Reviewed-by: Jan Kara <jack@suse.cz>
---
 include/net/xfrm.h    |    1 +
 net/xfrm/xfrm_state.c |    4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)

--- a/include/net/xfrm.h
+++ b/include/net/xfrm.h
@@ -427,6 +427,7 @@ int xfrm_input_register_afinfo(const str
 int xfrm_input_unregister_afinfo(const struct xfrm_input_afinfo *afinfo);
 
 void xfrm_flush_gc(void);
+void xfrm_state_delete_tunnel(struct xfrm_state *x);
 
 struct xfrm_type {
 	struct module		*owner;
--- a/net/xfrm/xfrm_state.c
+++ b/net/xfrm/xfrm_state.c
@@ -531,7 +531,6 @@ void xfrm_state_free(struct xfrm_state *
 }
 EXPORT_SYMBOL(xfrm_state_free);
 
-static void xfrm_state_delete_tunnel(struct xfrm_state *x);
 static void ___xfrm_state_destroy(struct xfrm_state *x)
 {
 	hrtimer_cancel(&x->mtimer);
@@ -2905,7 +2904,7 @@ void xfrm_flush_gc(void)
 }
 EXPORT_SYMBOL(xfrm_flush_gc);
 
-static void xfrm_state_delete_tunnel(struct xfrm_state *x)
+void xfrm_state_delete_tunnel(struct xfrm_state *x)
 {
 	if (x->tunnel) {
 		struct xfrm_state *t = x->tunnel;
@@ -2916,6 +2915,7 @@ static void xfrm_state_delete_tunnel(str
 		x->tunnel = NULL;
 	}
 }
+EXPORT_SYMBOL(xfrm_state_delete_tunnel);
 
 u32 xfrm_state_mtu(struct xfrm_state *x, int mtu)
 {
