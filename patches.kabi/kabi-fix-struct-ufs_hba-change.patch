From: Lee Duncan <lduncan@suse.com>
Date: Sun 28 Dec 2025 03:26:52 PM PST
Subject: kabi: fix struct ufs_hba changes
Patch-mainline: Never, kabi workaround
References: bsc#1253414 CVE-2025-40130

The fix (see 79dde5f7dc7c "scsi: ufs: core: Fix data race
in CPU latency PM QoS request handling") adds a member
at the end of "struct ufs_hba".

Mitigate this change to the kABI by hiding
the new member from kABI checks, since this
new member is at the end of the struct, and
because the ufs-core module controls allocation
of this struct.

Signed-off-by: Lee Duncan <lduncan@suse.com>
Reviewed-by: Michal Koutn√Ω <mkoutny@suse.com>
---
 include/ufs/ufshcd.h |    2 ++
 1 file changed, 2 insertions(+)

--- a/include/ufs/ufshcd.h
+++ b/include/ufs/ufshcd.h
@@ -1133,8 +1133,10 @@ struct ufs_hba {
 	struct pm_qos_request pm_qos_req;
 	bool pm_qos_enabled;
 
+#ifndef __GENKSYMS__
 	/* synchronizes PM QoS request and status updates */
 	struct mutex pm_qos_mutex;
+#endif
 };
 
 /**
