From: Gabriel Krisman Bertazi <krisman@suse.de>
Subject: io_uring: Preserve kABI in io_buffer_list
Patch-mainline: Never, kabi
References: git-fixes

Field ->is_ready was removed and it was followed by a 3 byte hole.
Anotate and preserve that gap for future use.

---
 io_uring/kbuf.h |   13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

--- a/io_uring/kbuf.h
+++ b/io_uring/kbuf.h
@@ -25,8 +25,6 @@ struct io_buffer_list {
 	__u16 head;
 	__u16 mask;
 
-	atomic_t refs;
-
 	/* ring mapped provided buffers */
 #ifdef __GENKSYMS__
 	__u8 is_mapped;
@@ -36,6 +34,17 @@ struct io_buffer_list {
 
 	/* ring mapped provided buffers, but mmap'ed by application */
 	__u8 is_mmap;
+
+	/*
+	 * kABI: ->is_ready is unsused, but preserved for kABI purposes.
+	 * ->refs uses that space plus the 3-byte of the rest of the
+	 * word.
+	 */
+#ifdef __GENKSYMS__
+	__u8 is_ready;
+#else
+	atomic_t refs;
+#endif
 };
 
 struct io_buffer {
