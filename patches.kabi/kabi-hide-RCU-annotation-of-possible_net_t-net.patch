From: Michal Kubecek <mkubecek@suse.cz>
Date: Wed, 17 Dec 2025 20:52:05 +0100
Subject: kabi: hide RCU annotation of possible_net_t::net
Patch-mainline: Never, kabi workaround
References: CVE-2025-40139 bsc#1253409

Backport of mainline commit 2034d90ae41a ("net: treat possible_net_t net
pointer as an RCU one and add read_pnet_rcu()") adds RCU annotation of net
pointer in struct typedef-ed as possible_net_t. In practice it's still the
same pointer so that out of tree modules built against old source would
still work and the only difference is that related sparse check cannot be
used which cannot really be helped. Therefore we can simply hide the added
annotation from genksyms.

Signed-off-by: Michal Kubecek <mkubecek@suse.cz>
Acked-by: Michal Koutny <mkoutny@suse.com>
---
 include/net/net_namespace.h | 4 ++++
 1 file changed, 4 insertions(+)

--- a/include/net/net_namespace.h
+++ b/include/net/net_namespace.h
@@ -311,8 +311,12 @@ static inline int check_net(const struct net *net)
 
 typedef struct {
 #ifdef CONFIG_NET_NS
+#ifdef __GENKSYMS__
+	struct net *net;
+#else
 	struct net __rcu *net;
 #endif
+#endif
 } possible_net_t;
 
 static inline void write_pnet(possible_net_t *pnet, struct net *net)
