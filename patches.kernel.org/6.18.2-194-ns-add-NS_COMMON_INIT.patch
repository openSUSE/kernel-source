From: Christian Brauner <brauner@kernel.org>
Date: Mon, 3 Nov 2025 16:10:10 +0100
Subject: [PATCH] ns: add NS_COMMON_INIT()
References: bsc#1012628
Patch-mainline: 6.18.2
Git-commit: d915fe20e5cba4bd50e41e792a32dcddc7490e25

[ Upstream commit d915fe20e5cba4bd50e41e792a32dcddc7490e25 ]

Add an initializer that can be used for the ns common initialization for
static namespace such as most init namespaces.

Suggested-by: Thomas Gleixner <tglx@linutronix.de>
Link: https://patch.msgid.link/87ecqhy2y5.ffs@tglx
Signed-off-by: Christian Brauner <brauner@kernel.org>
Stable-dep-of: 3dd50c58664e ("ns: initialize ns_list_node for initial namespaces")
Signed-off-by: Sasha Levin <sashal@kernel.org>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/ns_common.h | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/include/linux/ns_common.h b/include/linux/ns_common.h
index f5b68b8abb54..3a72c3f81eca 100644
--- a/include/linux/ns_common.h
+++ b/include/linux/ns_common.h
@@ -119,6 +119,16 @@ void __ns_common_free(struct ns_common *ns);
 		struct user_namespace *:   CLONE_NEWUSER,   \
 		struct uts_namespace *:    CLONE_NEWUTS)
 
+#define NS_COMMON_INIT(nsname, refs)							\
+{											\
+	.ns_type		= ns_common_type(&nsname),				\
+	.ns_id			= 0,							\
+	.inum			= ns_init_inum(&nsname),				\
+	.ops			= to_ns_operations(&nsname),				\
+	.stashed		= NULL,							\
+	.__ns_ref		= REFCOUNT_INIT(refs),					\
+}
+
 #define ns_common_init(__ns)                     \
 	__ns_common_init(to_ns_common(__ns),     \
 			 ns_common_type(__ns),   \
-- 
2.52.0

