From: Christian Brauner <brauner@kernel.org>
Date: Wed, 29 Oct 2025 13:20:21 +0100
Subject: [PATCH] ns: initialize ns_list_node for initial namespaces
References: bsc#1012628 CVE-2025-68377 bsc#1255592
Patch-mainline: 6.18.2
Git-commit: 3dd50c58664e2684bd610a57bf3ab713cbb0ea91

[ Upstream commit 3dd50c58664e2684bd610a57bf3ab713cbb0ea91 ]

Make sure that the list is always initialized for initial namespaces.

Link: https://patch.msgid.link/20251029-work-namespace-nstree-listns-v4-8-2e6f823ebdc0@kernel.org
Fixes: 885fc8ac0a4d ("nstree: make iterator generic")
Tested-by: syzbot@syzkaller.appspotmail.com
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Christian Brauner <brauner@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/ns_common.h | 1 +
 1 file changed, 1 insertion(+)

diff --git a/include/linux/ns_common.h b/include/linux/ns_common.h
index 3a72c3f81eca..71a5e28344d1 100644
--- a/include/linux/ns_common.h
+++ b/include/linux/ns_common.h
@@ -127,6 +127,7 @@ void __ns_common_free(struct ns_common *ns);
 	.ops			= to_ns_operations(&nsname),				\
 	.stashed		= NULL,							\
 	.__ns_ref		= REFCOUNT_INIT(refs),					\
+	.ns_list_node		= LIST_HEAD_INIT(nsname.ns.ns_list_node),		\
 }
 
 #define ns_common_init(__ns)                     \
-- 
2.52.0

