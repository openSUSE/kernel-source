From 0c8e393941d25ea13a659f184c6dc76194a473b5 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Wed, 9 Jul 2025 18:04:30 +0200
Subject: [PATCH] ALSA: hda: Return the codec init error properly at snd_hda_codec_build_controls()
Git-commit: 0c8e393941d25ea13a659f184c6dc76194a473b5
Patch-mainline: v6.17-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

The error from snd_hda_codec_init() was ignored in
snd_hda_codec_build_controls(), which should have been taken account
and abort the flow.  Fix it now.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: https://patch.msgid.link/20250709160434.1859-28-tiwai@suse.de

---
 sound/hda/common/codec.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/sound/hda/common/codec.c b/sound/hda/common/codec.c
index fa07a296abe8..8e47769ef0ce 100644
--- a/sound/hda/common/codec.c
+++ b/sound/hda/common/codec.c
@@ -3065,14 +3065,16 @@ EXPORT_SYMBOL_GPL(snd_pcm_2_1_chmaps);
 int snd_hda_codec_build_controls(struct hda_codec *codec)
 {
 	struct hda_codec_driver *driver = hda_codec_to_driver(codec);
-	int err = 0;
+	int err;
 
 	hda_exec_init_verbs(codec);
 	/* continue to initialize... */
 	err = snd_hda_codec_init(codec);
-	if (!err) {
-		if (driver->ops->build_controls)
-			err = driver->ops->build_controls(codec);
+	if (err < 0)
+		return err;
+
+	if (driver->ops->build_controls) {
+		err = driver->ops->build_controls(codec);
 		if (err < 0)
 			return err;
 	}
-- 
2.52.0

