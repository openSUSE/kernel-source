From 635333e400e2e678258ea45232415cdadadd7818 Mon Sep 17 00:00:00 2001
From: Max Gurtovoy <maxg@mellanox.com>
Date: Tue, 16 Jun 2020 12:34:22 +0300
Patch-mainline: v5.8-rc3
Git-commit: 635333e400e2e678258ea45232415cdadadd7818
Subject: [PATCH] nvme-pci: override the value of the controller's numa node
References: bsc#1176507

Set the node value according to the PCI device numa node.

Signed-off-by: Max Gurtovoy <maxg@mellanox.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Acked-by: Enzo Matsumiya <ematsumiya@suse.de>
---
 drivers/nvme/host/pci.c | 2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/nvme/host/pci.c
+++ b/drivers/nvme/host/pci.c
@@ -1696,6 +1696,8 @@ static int nvme_pci_configure_admin_queu
 	if (result)
 		return result;
 
+	dev->ctrl.numa_node = dev_to_node(dev->dev);
+
 	nvmeq = &dev->queues[0];
 	aqa = nvmeq->q_depth - 1;
 	aqa |= aqa << 16;
