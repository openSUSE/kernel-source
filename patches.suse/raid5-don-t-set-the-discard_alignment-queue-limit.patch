From: Christoph Hellwig <hch@lst.de>
Date: Mon, 18 Apr 2022 06:53:09 +0200
Subject: [PATCH] raid5: don't set the discard_alignment queue limit
Git-commit: 3d50d368c92ade2f98a3d0d28b842a57c35284e9
Patch-mainline: v5.19-rc1
References: jsc#PED-1183

The discard_alignment queue limit is named a bit misleading means the
offset into the block device at which the discard granularity starts.
Setting it to the discard granularity as done by raid5 is mostly
harmless but also useless.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Acked-by: Song Liu <song@kernel.org>
Reviewed-by: Martin K. Petersen <martin.petersen@oracle.com>
Link: https://lore.kernel.org/r/20220418045314.360785-7-hch@lst.de
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.com>
---
 drivers/md/raid5.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/drivers/md/raid5.c b/drivers/md/raid5.c
index 144ea077c2ed..39038fa8b1c8 100644
--- a/drivers/md/raid5.c
+++ b/drivers/md/raid5.c
@@ -7785,7 +7785,6 @@ static int raid5_run(struct mddev *mddev)
 		 * currently assumes that */
 		while ((stripe-1) & stripe)
 			stripe = (stripe | (stripe-1)) + 1;
-		mddev->queue->limits.discard_alignment = stripe;
 		mddev->queue->limits.discard_granularity = stripe;
 
 		blk_queue_max_write_zeroes_sectors(mddev->queue, 0);
-- 
2.35.3

