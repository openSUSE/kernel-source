From 2a46fbb25ae8ef98f44003bbcc0b4480b3b9281e Mon Sep 17 00:00:00 2001
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
Date: Wed, 3 Jul 2019 11:36:39 +0000
Subject: [PATCH] drm/i915/guc: Upgrade to GuC 33.0.0
Git-commit: 2a46fbb25ae8ef98f44003bbcc0b4480b3b9281e
Patch-mainline: v5.4-rc1
References: jsc#SLE-7953

New GuC firmware is available. Let's use it.

Signed-off-by: Michal Wajdeczko <michal.wajdeczko@intel.com>
Cc: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
Reviewed-by: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Link: https://patchwork.freedesktop.org/patch/msgid/20190703113640.31100-1-michal.wajdeczko@intel.com
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/i915/intel_guc_fw.c   | 20 ++++++++++----------
 drivers/gpu/drm/i915/intel_guc_fwif.h |  7 +------
 2 files changed, 11 insertions(+), 16 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_guc_fw.c b/drivers/gpu/drm/i915/intel_guc_fw.c
index 970f39ef248b..db1e0daca7db 100644
--- a/drivers/gpu/drm/i915/intel_guc_fw.c
+++ b/drivers/gpu/drm/i915/intel_guc_fw.c
@@ -38,37 +38,37 @@
 	__stringify(KEY##_GUC_FW_PATCH) ".bin"
 
 #define SKL_GUC_FW_PREFIX skl
-#define SKL_GUC_FW_MAJOR 32
+#define SKL_GUC_FW_MAJOR 33
 #define SKL_GUC_FW_MINOR 0
-#define SKL_GUC_FW_PATCH 3
+#define SKL_GUC_FW_PATCH 0
 #define SKL_GUC_FIRMWARE_PATH __MAKE_GUC_FW_PATH(SKL)
 MODULE_FIRMWARE(SKL_GUC_FIRMWARE_PATH);
 
 #define BXT_GUC_FW_PREFIX bxt
-#define BXT_GUC_FW_MAJOR 32
+#define BXT_GUC_FW_MAJOR 33
 #define BXT_GUC_FW_MINOR 0
-#define BXT_GUC_FW_PATCH 3
+#define BXT_GUC_FW_PATCH 0
 #define BXT_GUC_FIRMWARE_PATH __MAKE_GUC_FW_PATH(BXT)
 MODULE_FIRMWARE(BXT_GUC_FIRMWARE_PATH);
 
 #define KBL_GUC_FW_PREFIX kbl
-#define KBL_GUC_FW_MAJOR 32
+#define KBL_GUC_FW_MAJOR 33
 #define KBL_GUC_FW_MINOR 0
-#define KBL_GUC_FW_PATCH 3
+#define KBL_GUC_FW_PATCH 0
 #define KBL_GUC_FIRMWARE_PATH __MAKE_GUC_FW_PATH(KBL)
 MODULE_FIRMWARE(KBL_GUC_FIRMWARE_PATH);
 
 #define GLK_GUC_FW_PREFIX glk
-#define GLK_GUC_FW_MAJOR 32
+#define GLK_GUC_FW_MAJOR 33
 #define GLK_GUC_FW_MINOR 0
-#define GLK_GUC_FW_PATCH 3
+#define GLK_GUC_FW_PATCH 0
 #define GLK_GUC_FIRMWARE_PATH __MAKE_GUC_FW_PATH(GLK)
 MODULE_FIRMWARE(GLK_GUC_FIRMWARE_PATH);
 
 #define ICL_GUC_FW_PREFIX icl
-#define ICL_GUC_FW_MAJOR 32
+#define ICL_GUC_FW_MAJOR 33
 #define ICL_GUC_FW_MINOR 0
-#define ICL_GUC_FW_PATCH 3
+#define ICL_GUC_FW_PATCH 0
 #define ICL_GUC_FIRMWARE_PATH __MAKE_GUC_FW_PATH(ICL)
 MODULE_FIRMWARE(ICL_GUC_FIRMWARE_PATH);
 
diff --git a/drivers/gpu/drm/i915/intel_guc_fwif.h b/drivers/gpu/drm/i915/intel_guc_fwif.h
index 92bd7ffb5b10..30cca3a29323 100644
--- a/drivers/gpu/drm/i915/intel_guc_fwif.h
+++ b/drivers/gpu/drm/i915/intel_guc_fwif.h
@@ -43,13 +43,8 @@
 #define GUC_VIDEO_ENGINE2		4
 #define GUC_MAX_ENGINES_NUM		(GUC_VIDEO_ENGINE2 + 1)
 
-/*
- * XXX: Beware that Gen9 firmware 32.x uses wrong definition for
- * GUC_MAX_INSTANCES_PER_CLASS (1) but this is harmless for us now
- * as we are not enabling GuC submission mode where this will be used
- */
 #define GUC_MAX_ENGINE_CLASSES		5
-#define GUC_MAX_INSTANCES_PER_CLASS	4
+#define GUC_MAX_INSTANCES_PER_CLASS	16
 
 #define GUC_DOORBELL_INVALID		256
 
-- 
2.16.4

