From: Peter Zijlstra <peterz@infradead.org>
Date: Tue, 12 Aug 2025 12:39:07 +0200
Subject: perf: Reflow to get rid of aux_success label
Git-commit: 8558dca9fbdf825edf30b5fb74fbbbf3e6ba5dce
Patch-mainline: v6.18-rc1
References: perf-events-v6.19-update

Mostly re-indent noise needed to get rid of that label.

Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
Reviewed-by: Lorenzo Stoakes <lorenzo.stoakes@oracle.com>
Link: https://lore.kernel.org/r/20250812104019.362581570@infradead.org

Signed-off-by: Tony Jones <tonyj@suse.de>
---
 kernel/events/core.c | 37 ++++++++++++++++++-------------------
 1 file changed, 18 insertions(+), 19 deletions(-)

diff --git a/kernel/events/core.c b/kernel/events/core.c
index 236c60adde88..5bbea8127bb6 100644
--- a/kernel/events/core.c
+++ b/kernel/events/core.c
@@ -7130,30 +7130,29 @@ static int perf_mmap(struct file *file, struct vm_area_struct *vma)
 		if (rb_has_aux(rb)) {
 			atomic_inc(&rb->aux_mmap_count);
 			ret = 0;
-			goto aux_success;
-		}
 
-		if (!perf_mmap_calc_limits(vma, &user_extra, &extra)) {
-			ret = -EPERM;
-			atomic_dec(&rb->mmap_count);
-			goto unlock;
-		}
+		} else {
+			if (!perf_mmap_calc_limits(vma, &user_extra, &extra)) {
+				ret = -EPERM;
+				atomic_dec(&rb->mmap_count);
+				goto unlock;
+			}
 
-		WARN_ON(!rb && event->rb);
+			WARN_ON(!rb && event->rb);
 
-		if (vma->vm_flags & VM_WRITE)
-			flags |= RING_BUFFER_WRITABLE;
+			if (vma->vm_flags & VM_WRITE)
+				flags |= RING_BUFFER_WRITABLE;
 
-		ret = rb_alloc_aux(rb, event, vma->vm_pgoff, nr_pages,
-				   event->attr.aux_watermark, flags);
-		if (ret) {
-			atomic_dec(&rb->mmap_count);
-			goto unlock;
-		}
+			ret = rb_alloc_aux(rb, event, vma->vm_pgoff, nr_pages,
+					   event->attr.aux_watermark, flags);
+			if (ret) {
+				atomic_dec(&rb->mmap_count);
+				goto unlock;
+			}
 
-		atomic_set(&rb->aux_mmap_count, 1);
-		rb->aux_mmap_locked = extra;
-aux_success:
+			atomic_set(&rb->aux_mmap_count, 1);
+			rb->aux_mmap_locked = extra;
+		}
 		perf_mmap_account(vma, user_extra, extra);
 		atomic_inc(&event->mmap_count);
 	}

