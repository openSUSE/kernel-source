From: Lin Yujun <linyujun809@h-partners.com>
Date: Mon, 8 Sep 2025 20:20:22 +0800
Subject: [PATCH] coresight: Fix incorrect handling for return value of
 devm_kzalloc
Git-commit: 70714eb7243eaf333d23501d4c7bdd9daf011c01
Patch-mainline: v6.18-rc1
References: CVE-2025-40059 bsc#1252809

The return value of devm_kzalloc could be an null pointer,
use "!desc.pdata" to fix incorrect handling return value
of devm_kzalloc.

Fixes: 4277f035d227 ("coresight: trbe: Add a representative coresight_platform_data for TRBE")
Signed-off-by: Lin Yujun <linyujun809@h-partners.com>
Reviewed-by: James Clark <james.clark@linaro.org>
Signed-off-by: Suzuki K Poulose <suzuki.poulose@arm.com>
Link: https://lore.kernel.org/r/20250908122022.1315399-1-linyujun809@h-partners.com
Signed-off-by: David Sterba <dsterba@suse.com>
---
 drivers/hwtracing/coresight/coresight-trbe.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/hwtracing/coresight/coresight-trbe.c
+++ b/drivers/hwtracing/coresight/coresight-trbe.c
@@ -1263,7 +1263,7 @@ static void arm_trbe_register_coresight_
 	 * into the device for that purpose.
 	 */
 	desc.pdata = devm_kzalloc(dev, sizeof(*desc.pdata), GFP_KERNEL);
-	if (IS_ERR(desc.pdata))
+	if (!desc.pdata)
 		goto cpu_clear;
 
 	desc.type = CORESIGHT_DEV_TYPE_SINK;
