From: Anshumali Gaur <agaur@marvell.com>
Date: Fri, 19 Dec 2025 11:52:26 +0530
Subject: [PATCH] octeontx2-pf: fix "UBSAN: shift-out-of-bounds error"
Git-commit: 85f4b0c650d9f9db10bda8d3acfa1af83bf78cf7
Patch-mainline: v6.19-rc4
References: CVE-2025-71137 bsc#1256760

This patch ensures that the RX ring size (rx_pending) is not
set below the permitted length. This avoids UBSAN
shift-out-of-bounds errors when users passes small or zero
ring sizes via ethtool -G.

Fixes: d45d8979840d ("octeontx2-pf: Add basic ethtool support")
Signed-off-by: Anshumali Gaur <agaur@marvell.com>
Link: https://patch.msgid.link/20251219062226.524844-1-agaur@marvell.com
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: David Sterba <dsterba@suse.com>
---
 drivers/net/ethernet/marvell/octeontx2/nic/otx2_ethtool.c |    8 ++++++++
 1 file changed, 8 insertions(+)

--- a/drivers/net/ethernet/marvell/octeontx2/nic/otx2_ethtool.c
+++ b/drivers/net/ethernet/marvell/octeontx2/nic/otx2_ethtool.c
@@ -417,6 +417,14 @@ static int otx2_set_ringparam(struct net
 	 */
 	if (rx_count < pfvf->hw.rq_skid)
 		rx_count =  pfvf->hw.rq_skid;
+
+	if (ring->rx_pending < 16) {
+		netdev_err(netdev,
+			   "rx ring size %u invalid, min is 16\n",
+			   ring->rx_pending);
+		return -EINVAL;
+	}
+
 	rx_count = Q_COUNT(Q_SIZE(rx_count, 3));
 
 	/* Due pipelining impact minimum 2000 unused SQ CQE's
