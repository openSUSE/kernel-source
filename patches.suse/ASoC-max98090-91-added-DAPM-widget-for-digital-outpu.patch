From 638bae3fb225a708dc67db613af62f6d14c4eff4 Mon Sep 17 00:00:00 2001
From: Sharique Mohammad <sharq0406@gmail.com>
Date: Tue, 21 Oct 2025 16:56:11 +0200
Subject: [PATCH] ASoC: max98090/91: added DAPM widget for digital output for max98091
Git-commit: 638bae3fb225a708dc67db613af62f6d14c4eff4
Patch-mainline: v6.19-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

Added DAPM widget for digital output path from codec to the
CPU DAI (capture) for secondary digital mic. "AIFOUT2L" is the
left audio channel output and "AIFOUT2R" is the right audio
channel output, both belonging to the stream "HiFi Capture".
Stream index given as 2 and 3 respectively, as 0 and 1 belongs
to "AIFOUTL" and "AIFOUTR" of the primary digital mic. Now
with this commit the total channels increase to 4, so changing
the ".channels_max" for ".capture" to 4 accordingly in the
"struct snd_soc_dai_driver max98090_dai". This will work
for max98090 and max98091 both because in case of max98090
only 1 or 2 channels could be used and in case of max98091
maximum 4 channels could be used. Both the cases get satisfied with
".channels_max" as 4.

Signed-off-by: Sharique Mohammad <sharq0406@gmail.com>
Link: https://patch.msgid.link/20251021145611.1750689-1-sharq0406@gmail.com
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/codecs/max98090.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/sound/soc/codecs/max98090.c b/sound/soc/codecs/max98090.c
index b3101e07906c..ceb5b8c3bb5c 100644
--- a/sound/soc/codecs/max98090.c
+++ b/sound/soc/codecs/max98090.c
@@ -1241,6 +1241,11 @@ static const struct snd_soc_dapm_widget max98091_dapm_widgets[] = {
 			 SND_SOC_DAPM_POST_PMU),
 	SND_SOC_DAPM_SUPPLY("DMIC34_HPF", M98090_REG_FILTER_CONFIG,
 		M98090_FLT_DMIC34HPF_SHIFT, 0, NULL, 0),
+
+	SND_SOC_DAPM_AIF_OUT("AIFOUT2L", "HiFi Capture", 2,
+		SND_SOC_NOPM, 0, 0),
+	SND_SOC_DAPM_AIF_OUT("AIFOUT2R", "HiFi Capture", 3,
+		SND_SOC_NOPM, 0, 0),
 };
 
 static const struct snd_soc_dapm_route max98090_dapm_routes[] = {
@@ -2371,7 +2376,7 @@ static struct snd_soc_dai_driver max98090_dai = {
 	.capture = {
 		.stream_name = "HiFi Capture",
 		.channels_min = 1,
-		.channels_max = 2,
+		.channels_max = 4,
 		.rates = MAX98090_RATES,
 		.formats = MAX98090_FORMATS,
 	},
-- 
2.52.0

