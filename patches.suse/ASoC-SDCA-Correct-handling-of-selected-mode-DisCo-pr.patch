From 9ef52d529bb75071e03cf85078f724d69c4abe89 Mon Sep 17 00:00:00 2001
From: Charles Keepax <ckeepax@opensource.cirrus.com>
Date: Fri, 21 Mar 2025 13:53:24 +0000
Subject: [PATCH] ASoC: SDCA: Correct handling of selected mode DisCo property
Git-commit: 9ef52d529bb75071e03cf85078f724d69c4abe89
Patch-mainline: v6.15-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

mipi-sdca-ge-selectedmode-controls-affected is actually required by the
specification so the code should return an error if it is missing.

Reported-by: Maciej Strozek <mstrozek@opensource.cirrus.com>
Fixes: 13fe7497af19 ("ASoC: SDCA: Add support for GE Entity properties")
Signed-off-by: Charles Keepax <ckeepax@opensource.cirrus.com>
Link: https://patch.msgid.link/20250321135324.380237-1-ckeepax@opensource.cirrus.com
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/sdca/sdca_functions.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sound/soc/sdca/sdca_functions.c b/sound/soc/sdca/sdca_functions.c
index c8efdc5301b5..493f390f087a 100644
--- a/sound/soc/sdca/sdca_functions.c
+++ b/sound/soc/sdca/sdca_functions.c
@@ -1159,7 +1159,7 @@ static int find_sdca_entity_ge(struct device *dev,
 
 	num_affected = fwnode_property_count_u8(entity_node,
 						"mipi-sdca-ge-selectedmode-controls-affected");
-	if (!num_affected || num_affected == -EINVAL) {
+	if (!num_affected) {
 		return 0;
 	} else if (num_affected < 0) {
 		dev_err(dev, "%s: failed to read affected controls: %d\n",
-- 
2.52.0

