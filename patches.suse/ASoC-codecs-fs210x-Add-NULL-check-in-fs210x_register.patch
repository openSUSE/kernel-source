From be585f7ebc99598edf97c3001d0f8d67954ab376 Mon Sep 17 00:00:00 2001
From: Charles Han <hanchunchao@inspur.com>
Date: Fri, 5 Sep 2025 17:18:44 +0800
Subject: [PATCH] ASoC: codecs: fs210x: Add NULL check in fs210x_register_snd_component
Git-commit: be585f7ebc99598edf97c3001d0f8d67954ab376
Patch-mainline: v6.18-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

Add check for the return value of devm_kmemdup() to prevent
potential null pointer dereference.

Fixes: 756117701779 ("ASoC: codecs: Add FourSemi FS2104/5S audio amplifier driver")
Signed-off-by: Charles Han <hanchunchao@inspur.com>
Message-id: <20250905091845.1559-1-hanchunchao@inspur.com>
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/codecs/fs210x.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/sound/soc/codecs/fs210x.c b/sound/soc/codecs/fs210x.c
index b4f51ee7235a..e2f85714972d 100644
--- a/sound/soc/codecs/fs210x.c
+++ b/sound/soc/codecs/fs210x.c
@@ -1458,6 +1458,9 @@ static int fs210x_register_snd_component(struct fs210x_priv *fs210x)
 	dai_drv->name = devm_kasprintf(fs210x->dev,
 				       GFP_KERNEL, "%s-%d",
 				       dai_drv->name, instance_id);
+	if (!dai_drv->name)
+		return -ENOMEM;
+
 	instance_id++;
 
 	if (fs210x->devid == FS2105S_DEVICE_ID) {
-- 
2.52.0

