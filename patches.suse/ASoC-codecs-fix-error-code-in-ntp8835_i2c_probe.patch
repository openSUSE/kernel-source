From 9c2e48ee9aa64f609709eeb120cf728d66d4a145 Mon Sep 17 00:00:00 2001
From: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Date: Wed, 23 Oct 2024 07:44:11 -0700
Subject: [PATCH] ASoC: codecs: fix error code in ntp8835_i2c_probe()
Git-commit: 9c2e48ee9aa64f609709eeb120cf728d66d4a145
Patch-mainline: v6.13-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

When reset_control_deassert() fails it returns valid error codes stored
in return, pass that to dev_err_probe() instead of
PTR_ERR(ntp8835->reset).

Fixes: dc9004ea273a ("ASoC: codecs: Add NeoFidelity NTP8835 codec")
Reported-by: kernel test robot <lkp@intel.com>
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Closes: https://lore.kernel.org/r/202409281054.DUTb5KxU-lkp@intel.com/
Signed-off-by: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Link: https://patch.msgid.link/20241023144421.1720234-1-harshit.m.mogalapalli@oracle.com
Signed-off-by: Mark Brown <broonie@kernel.org>
Acked-by: Takashi Iwai <tiwai@suse.de>

---
 sound/soc/codecs/ntp8835.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sound/soc/codecs/ntp8835.c b/sound/soc/codecs/ntp8835.c
index 800bda6b49dd..796e1410496f 100644
--- a/sound/soc/codecs/ntp8835.c
+++ b/sound/soc/codecs/ntp8835.c
@@ -428,7 +428,7 @@ static int ntp8835_i2c_probe(struct i2c_client *i2c)
 
 	ret = reset_control_deassert(ntp8835->reset);
 	if (ret)
-		return dev_err_probe(&i2c->dev, PTR_ERR(ntp8835->reset),
+		return dev_err_probe(&i2c->dev, ret,
 				     "Failed to deassert reset\n");
 
 	dev_set_drvdata(&i2c->dev, ntp8835);
-- 
2.52.0

