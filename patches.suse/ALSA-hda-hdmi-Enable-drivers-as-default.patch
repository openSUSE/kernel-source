From 81231ad173d840693f8d5f34ad9ada75aa8ad79f Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Wed, 30 Jul 2025 08:46:35 +0200
Subject: [PATCH] ALSA: hda/hdmi: Enable drivers as default
Git-commit: 81231ad173d840693f8d5f34ad9ada75aa8ad79f
Patch-mainline: v6.17-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

Like other HD-audio codec drivers, HD-audio HDMI codec driver was
split to multiple drivers, and now users are forced to choose the
right kconfig items.

For smoother upgrade path, keep the previous CONFIG_SND_HDA_CODEC_HDMI
as the meuconfig, so that the kconfig can be taken over from the
previous config.  The all belonging HDMI codec drivers are enabled as
default as long as CONFIG_SND_HDA_CODEC_HDMI is set.

This is only about the default config, and each driver can be still
disabled if user wants to reduce the size, too.

The kconfig for the generic HDMI driver is changed to
CONFIG_SND_HDA_CODEC_HDMI_GENERIC along with this action.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: https://patch.msgid.link/20250730064639.25617-4-tiwai@suse.de

---
 sound/hda/codecs/hdmi/Kconfig  | 24 +++++++++++++++++++-----
 sound/hda/codecs/hdmi/Makefile |  2 +-
 2 files changed, 20 insertions(+), 6 deletions(-)

diff --git a/sound/hda/codecs/hdmi/Kconfig b/sound/hda/codecs/hdmi/Kconfig
index 498000d2c6ae..973ca4ca077b 100644
--- a/sound/hda/codecs/hdmi/Kconfig
+++ b/sound/hda/codecs/hdmi/Kconfig
@@ -1,9 +1,15 @@
 # SPDX-License-Identifier: GPL-2.0-only
 
-config SND_HDA_CODEC_HDMI
+menuconfig SND_HDA_CODEC_HDMI
+	tristate "HD-audio HDMI codec support"
+
+if SND_HDA_CODEC_HDMI
+
+config SND_HDA_CODEC_HDMI_GENERIC
 	tristate "Generic HDMI/DisplayPort HD-audio codec support"
 	select SND_DYNAMIC_MINORS
 	select SND_PCM_ELD
+	default y
 	help
 	  Say Y or M here to include Generic HDMI and DisplayPort HD-audio
 	  codec support.
@@ -13,13 +19,15 @@ config SND_HDA_CODEC_HDMI
 
 config SND_HDA_CODEC_HDMI_SIMPLE
 	tristate "Simple HDMI/DisplayPort HD-audio codec support"
+	default y
 	help
 	  Say Y or M here to include Simple HDMI and DisplayPort HD-audio
 	  codec support for VIA and other codecs.
 
 config SND_HDA_CODEC_HDMI_INTEL
 	tristate "Intel HDMI/DisplayPort HD-audio codec support"
-	select SND_HDA_CODEC_HDMI
+	select SND_HDA_CODEC_HDMI_GENERIC
+	default y
 	help
 	  Say Y or M here to include Intel graphics HDMI and DisplayPort
 	  HD-audio codec support.
@@ -41,14 +49,16 @@ config SND_HDA_INTEL_HDMI_SILENT_STREAM
 
 config SND_HDA_CODEC_HDMI_ATI
 	tristate "AMD/ATI HDMI/DisplayPort HD-audio codec support"
-	select SND_HDA_CODEC_HDMI
+	select SND_HDA_CODEC_HDMI_GENERIC
+	default y
 	help
 	  Say Y or M here to include AMD/ATI graphics HDMI and DisplayPort
 	  HD-audio codec support.
 
 config SND_HDA_CODEC_HDMI_NVIDIA
 	tristate "Nvidia HDMI/DisplayPort HD-audio codec support"
-	select SND_HDA_CODEC_HDMI
+	select SND_HDA_CODEC_HDMI_GENERIC
+	default y
 	help
 	  Say Y or M here to include HDMI and DisplayPort HD-audio codec
 	  support for the recent Nvidia graphics cards.
@@ -56,13 +66,17 @@ config SND_HDA_CODEC_HDMI_NVIDIA
 config SND_HDA_CODEC_HDMI_NVIDIA_MCP
 	tristate "Legacy Nvidia HDMI/DisplayPort HD-audio codec support"
 	select SND_HDA_CODEC_HDMI_SIMPLE
+	default y
 	help
 	  Say Y or M here to include HDMI and DisplayPort HD-audio codec
 	  support for the legacy Nvidia graphics like MCP73, MCP67, MCP77/78.
 
 config SND_HDA_CODEC_HDMI_TEGRA
 	tristate "Nvidia Tegra HDMI/DisplayPort HD-audio codec support"
-	select SND_HDA_CODEC_HDMI
+	select SND_HDA_CODEC_HDMI_GENERIC
+	default y
 	help
 	  Say Y or M here to include HDMI and DisplayPort HD-audio codec
 	  support for Nvidia Tegra.
+
+endif
diff --git a/sound/hda/codecs/hdmi/Makefile b/sound/hda/codecs/hdmi/Makefile
index c07a0a71b64f..0e49a9421e3b 100644
--- a/sound/hda/codecs/hdmi/Makefile
+++ b/sound/hda/codecs/hdmi/Makefile
@@ -9,7 +9,7 @@ snd-hda-codec-nvhdmi-y :=	nvhdmi.o
 snd-hda-codec-nvhdmi-mcp-y :=	nvhdmi-mcp.o
 snd-hda-codec-tegrahdmi-y :=	tegrahdmi.o
 
-obj-$(CONFIG_SND_HDA_CODEC_HDMI) += snd-hda-codec-hdmi.o
+obj-$(CONFIG_SND_HDA_CODEC_HDMI_GENERIC) += snd-hda-codec-hdmi.o
 obj-$(CONFIG_SND_HDA_CODEC_HDMI_SIMPLE) += snd-hda-codec-simplehdmi.o
 obj-$(CONFIG_SND_HDA_CODEC_HDMI_INTEL) += snd-hda-codec-intelhdmi.o
 obj-$(CONFIG_SND_HDA_CODEC_HDMI_ATI) += snd-hda-codec-atihdmi.o
-- 
2.52.0

