From: Linus Walleij <linus.walleij@linaro.org>
Date: Wed, 30 Oct 2019 13:29:14 +0100
Subject: gpiolib: Switch order of valid mask and hw init

Git-commit: 504369cd6d2ce34c1225063071ac7e0a5a4d5e30
Patch-mainline: v5.5-rc1
References: jsc#SLE-15847

The GPIO irqchip needs to initialize the valid mask
before initializing the IRQ hardware, because sometimes
the latter require the former to be executed first.

Cc: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Cc: Mika Westerberg <mika.westerberg@linux.intel.com>
Reported-by: Hans de Goede <hdegoede@redhat.com>
Link: https://lore.kernel.org/r/20191030122914.967-1-linus.walleij@linaro.org
Acked-by: Hans de Goede <hdegoede@redhat.com>
Reviewed-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
Signed-off-by: Mian Yousaf Kaukab <yousaf.kaukab@suse.com>
---
 drivers/gpio/gpiolib.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/gpio/gpiolib.c
+++ b/drivers/gpio/gpiolib.c
@@ -1405,11 +1405,11 @@ int gpiochip_add_data_with_key(struct gp
 
 	machine_gpiochip_add(chip);
 
-	status = gpiochip_irqchip_init_hw(chip);
+	status = gpiochip_irqchip_init_valid_mask(chip);
 	if (status)
 		goto err_remove_acpi_chip;
 
-	status = gpiochip_irqchip_init_valid_mask(chip);
+	status = gpiochip_irqchip_init_hw(chip);
 	if (status)
 		goto err_remove_acpi_chip;
 
