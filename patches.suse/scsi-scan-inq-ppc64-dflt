garloff@suse.de

Workaround

This broken chip seems to be so popular on PPC64 that the arch maintainers
want a PPC64 specific default. Oh well ...

Index: linux-2.6.8/drivers/scsi/scsi_scan.c
===================================================================
--- linux-2.6.8.orig/drivers/scsi/scsi_scan.c
+++ linux-2.6.8/drivers/scsi/scsi_scan.c
@@ -100,9 +100,19 @@ module_param_named(max_report_luns, max_
 MODULE_PARM_DESC(max_report_luns,
 		 "REPORT LUNS maximum number of LUNS received (should be"
 		 " between 1 and 16384)");
 
+/* Some AChip ARC765 based DVD-ROM's take 15 or more seconds
+ * to reset.  A scan will fail if made right after a reset.
+ * It's completely broken device behaviour: SCSI specification
+ * says devices need to be able to respond to INQUIRY always
+ * (after a selection timeout ... of 250ms).
+ */
+#ifdef __powerpc64__
+static unsigned int scsi_inq_timeout = SCSI_TIMEOUT/HZ+25;
+#else
 static unsigned int scsi_inq_timeout = SCSI_TIMEOUT/HZ+3;
+#endif
 
 module_param_named(inq_timeout, scsi_inq_timeout, int, S_IRUGO|S_IWUSR);
 MODULE_PARM_DESC(inq_timeout, 
 		 "Timeout (in seconds) waiting for devices to answer INQUIRY."

