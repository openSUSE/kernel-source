From 400f60b27415f927f8964dd32d1f5baa53782e5f Mon Sep 17 00:00:00 2001
From: Chandra Mohan Sundar <chandramohan.explore@gmail.com>
Date: Sat, 6 Sep 2025 21:51:54 +0530
Subject: [PATCH] ALSA: cs4281: Send the PCM period elapsed notification properly
Git-commit: 400f60b27415f927f8964dd32d1f5baa53782e5f
Patch-mainline: v6.18-rc1
References: jsc#PED-14430 jsc#PED-14297 jsc#PED-14024

As part of spin lock code cleanup using guard(), a new
variable (period_elapsed) was introduced. However this variable
is never set, causing period elapsed notification to be not sent.

Set the value of period_elapsed appropiately.

This issue was reported by static coverity analyzer.

Fixes: 7a5127c2c8a5a ("ALSA: cs4281: Use guard() for spin locks")
Signed-off-by: Chandra Mohan Sundar <chandramohan.explore@gmail.com>
Link: https://patch.msgid.link/20250906162158.564899-1-chandramohan.explore@gmail.com
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/pci/cs4281.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/sound/pci/cs4281.c b/sound/pci/cs4281.c
index c519fb9cdd1e..d00b2c9fb1e3 100644
--- a/sound/pci/cs4281.c
+++ b/sound/pci/cs4281.c
@@ -1752,6 +1752,7 @@ static irqreturn_t snd_cs4281_interrupt(int irq, void *dev_id)
 					chip->spurious_dtc_irq++;
 					continue;
 				}
+				period_elapsed = true;
 			}
 			if (period_elapsed)
 				snd_pcm_period_elapsed(cdma->substream);
-- 
2.52.0

