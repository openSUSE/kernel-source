From 3cb4e3ff0a1eb5554d96942a2095c9868642af1f Mon Sep 17 00:00:00 2001
From: Steve French <stfrench@microsoft.com>
Date: Fri, 28 Feb 2020 01:32:37 -0600
Subject: [PATCH] cifs: print warning once if mounting with vers=1.0
Patch-mainline: Not yet, in for-next branch
References: bsc#1164565

We really, really don't want people using insecure dialects
unless they realize what they are doing ...

Add print once warning if mounting with vers=1.0 (older SMB1/CIFS
dialect) instead of the default (SMB2.1 or later, typically
SMB3.1.1).

Signed-off-by: Steve French <stfrench@microsoft.com>
Acked-by: Paulo Alcantara <palcantara@suse.de>
---
 fs/cifs/connect.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/fs/cifs/connect.c b/fs/cifs/connect.c
index f4d12b79ceed..27577d71d942 100644
--- a/fs/cifs/connect.c
+++ b/fs/cifs/connect.c
@@ -1471,6 +1471,9 @@ cifs_parse_smb_version(char *value, struct smb_vol *vol, bool is_smb3)
 			cifs_dbg(VFS, "vers=1.0 (cifs) not permitted when mounting with smb3\n");
 			return 1;
 		}
+		printk_once(KERN_WARNING "Use of the less secure dialect "
+			   "vers=1.0 is not recommended unless required for "
+			   "access to very old servers\n");
 		vol->ops = &smb1_operations;
 		vol->vals = &smb1_values;
 		break;
-- 
2.25.1

