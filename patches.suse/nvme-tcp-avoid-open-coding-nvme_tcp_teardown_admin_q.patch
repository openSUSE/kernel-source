From: Hannes Reinecke <hare@suse.de>
Date: Tue, 24 Oct 2023 08:13:35 +0200
Subject: nvme-tcp: avoid open-coding nvme_tcp_teardown_admin_queue()
Patch-mainline: v6.7-rc1
Git-commit: fd1418de10b9ca03d78404cf00a95138689ea369
References: jsc#PED-6252 jsc#PED-5728 jsc#PED-5062 jsc#PED-3535

nvme_tcp_setup_ctrl() has an open-coded version of
nvme_tcp_teardown_admin_queue().

Signed-off-by: Hannes Reinecke <hare@suse.de>
Tested-by: Mark O'Donovan <shiftee@posteo.net>
Signed-off-by: Keith Busch <kbusch@kernel.org>
Acked-by: Daniel Wagner <dwagner@suse.de>
---
 drivers/nvme/host/tcp.c |    6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

--- a/drivers/nvme/host/tcp.c
+++ b/drivers/nvme/host/tcp.c
@@ -2237,11 +2237,7 @@ static int nvme_tcp_setup_ctrl(struct nv
 		nvme_tcp_destroy_io_queues(ctrl, new);
 	}
 destroy_admin:
-	nvme_quiesce_admin_queue(ctrl);
-	blk_sync_queue(ctrl->admin_q);
-	nvme_tcp_stop_queue(ctrl, 0);
-	nvme_cancel_admin_tagset(ctrl);
-	nvme_tcp_destroy_admin_queue(ctrl, new);
+	nvme_tcp_teardown_admin_queue(ctrl, false);
 	return ret;
 }
 
