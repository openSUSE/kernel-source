From 070e64c0d0fcd42adae11bddf06fb061370d7a7e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ville=20Syrj=C3=A4l=C3=A4?= <ville.syrjala@linux.intel.com>
Date: Fri, 29 Nov 2019 20:54:30 +0200
Subject: drm/i915: Dump the mode for the crtc just the once
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Git-commit: 5244221ee89b30f0e8add9e88482da873b6e0a54
Patch-mainline: v5.6-rc1
References: jsc#SLE-12680, jsc#SLE-12880, jsc#SLE-12882, jsc#SLE-12883, jsc#SLE-13496, jsc#SLE-15322

No point in repeating the crtc mode for each cloned encoder.
Just print it once, and avoid using multiple lines for it.
And while at let's polish the fixed mode print to fit on
one line as well.

Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20191129185434.25549-6-ville.syrjala@linux.intel.com
Reviewed-by: Ramalingam C <ramalingam.c@intel.com>
Signed-off-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/i915/i915_debugfs.c | 27 +++++++++------------------
 1 file changed, 9 insertions(+), 18 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index 28f45f25cfc0..11f3f91befb9 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -2388,29 +2388,16 @@ static void intel_encoder_info(struct seq_file *m,
 	seq_printf(m, "\tencoder %d: type: %s, connectors:\n",
 		   encoder->base.base.id, encoder->base.name);
 
-	for_each_connector_on_encoder(dev, &encoder->base, connector) {
-		seq_printf(m, "\t\tconnector %d: type: %s, status: %s",
-			   connector->base.base.id, connector->base.name,
-			   drm_get_connector_status_name(connector->base.status));
-
-		if (connector->base.status == connector_status_connected) {
-			const struct intel_crtc_state *crtc_state =
-				to_intel_crtc_state(crtc->base.state);
-
-			seq_printf(m, ", mode:\n");
-			intel_seq_print_mode(m, 2, &crtc_state->hw.mode);
-		} else {
-			seq_putc(m, '\n');
-		}
-	}
+	for_each_connector_on_encoder(dev, &encoder->base, connector)
+		seq_printf(m, "\t\tconnector %d: type: %s\n",
+			   connector->base.base.id, connector->base.name);
 }
 
 static void intel_panel_info(struct seq_file *m, struct intel_panel *panel)
 {
-	struct drm_display_mode *mode = panel->fixed_mode;
+	const struct drm_display_mode *mode = panel->fixed_mode;
 
-	seq_printf(m, "\tfixed mode:\n");
-	intel_seq_print_mode(m, 2, mode);
+	seq_printf(m, "\tfixed mode: " DRM_MODE_FMT "\n", DRM_MODE_ARG(mode));
 }
 
 static void intel_hdcp_info(struct seq_file *m,
@@ -2651,8 +2638,12 @@ static void intel_crtc_info(struct seq_file *m, struct intel_crtc *crtc)
 		   yesno(crtc_state->dither), crtc_state->pipe_bpp);
 
 	if (crtc_state->hw.active) {
+		const struct drm_display_mode *mode =
+			&crtc_state->hw.mode;
 		struct intel_encoder *encoder;
 
+		seq_printf(m, "\tmode: " DRM_MODE_FMT "\n", DRM_MODE_ARG(mode));
+
 		for_each_encoder_on_crtc(&dev_priv->drm, &crtc->base, encoder)
 			intel_encoder_info(m, crtc, encoder);
 
-- 
2.28.0

