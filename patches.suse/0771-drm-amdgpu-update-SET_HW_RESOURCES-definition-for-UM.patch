From 675111c6cac1e3b5368f2d1494710956794248b9 Mon Sep 17 00:00:00 2001
From: Lang Yu <Lang.Yu@amd.com>
Date: Mon, 17 Jul 2023 14:30:25 +0800
Subject: drm/amdgpu: update SET_HW_RESOURCES definition for UMSCH
Git-commit: 983ac45a06aec8987755c921aa53e81e6a69fb78
Patch-mainline: v6.7-rc1
References: jsc#PED-3527 jsc#PED-5475 jsc#PED-6068 jsc#PED-6070 jsc#PED-6116 jsc#PED-6120 jsc#PED-5065 jsc#PED-5477 jsc#PED-5511 jsc#PED-6041 jsc#PED-6069 jsc#PED-6071

Align with FW changes.

Signed-off-by: Lang Yu <Lang.Yu@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Patrik Jakobsson <pjakobsson@suse.de>
---
 drivers/gpu/drm/amd/amdgpu/umsch_mm_v4_0.c         | 3 +++
 drivers/gpu/drm/amd/include/umsch_mm_4_0_api_def.h | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/umsch_mm_v4_0.c b/drivers/gpu/drm/amd/amdgpu/umsch_mm_v4_0.c
index d3dec5f21bec..67164991f541 100644
--- a/drivers/gpu/drm/amd/amdgpu/umsch_mm_v4_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/umsch_mm_v4_0.c
@@ -279,6 +279,9 @@ static int umsch_mm_v4_0_set_hw_resources(struct amdgpu_umsch_mm *umsch)
 	       sizeof(uint32_t) * 5);
 	set_hw_resources.osssys_version = adev->ip_versions[OSSSYS_HWIP][0];
 
+	set_hw_resources.vcn_version = adev->ip_versions[VCN_HWIP][0];
+	set_hw_resources.vpe_version = adev->ip_versions[VPE_HWIP][0];
+
 	set_hw_resources.api_status.api_completion_fence_addr = umsch->ring.fence_drv.gpu_addr;
 	set_hw_resources.api_status.api_completion_fence_value = ++umsch->ring.fence_drv.sync_seq;
 
diff --git a/drivers/gpu/drm/amd/include/umsch_mm_4_0_api_def.h b/drivers/gpu/drm/amd/include/umsch_mm_4_0_api_def.h
index 086ce7792c29..beadb9e42850 100644
--- a/drivers/gpu/drm/amd/include/umsch_mm_4_0_api_def.h
+++ b/drivers/gpu/drm/amd/include/umsch_mm_4_0_api_def.h
@@ -212,6 +212,7 @@ union UMSCHAPI__SET_HW_RESOURCES {
 		union UMSCH_API_HEADER header;
 		uint32_t vmid_mask_mm_vcn;
 		uint32_t vmid_mask_mm_vpe;
+		uint32_t collaboration_mask_vpe;
 		uint32_t engine_mask;
 		uint32_t logging_vmid;
 		uint32_t vcn0_hqd_mask[MAX_VCN0_INSTANCES];
@@ -223,6 +224,8 @@ union UMSCHAPI__SET_HW_RESOURCES {
 		uint32_t mmhub_version;
 		uint32_t osssys_base[UMSCH_MAX_HWIP_SEGMENT];
 		uint32_t osssys_version;
+		uint32_t vcn_version;
+		uint32_t vpe_version;
 		struct UMSCH_API_STATUS api_status;
 		union {
 			struct {
-- 
2.43.0

