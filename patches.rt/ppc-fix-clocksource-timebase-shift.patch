Subject: Linux-RT 2.6.24-rc8-rt1
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
From tsutomu.owa@toshiba.co.jp Mon May 14 17:23:17 2007
Date: Mon, 14 May 2007 17:23:17 +0900
From: Tsutomu OWA <tsutomu.owa@toshiba.co.jp>
To: linuxppc-dev@ozlabs.org, linux-kernel@vger.kernel.org
Cc: mingo@elte.hu, tglx@linutronix.de
Subject: Re: [patch 5/5] powerpc 2.6.21-rt1] fix clocksource_timebase.shift value


Calculate clocksource_timebase.shift from tb_ticks_per_jiffy to get an
accurate translation, though I don't understand why current version of 
clocksource_timebase.shift could be constant...

Signed-off-by: Tsutomu OWA <tsutomu.owa@toshiba.co.jp>
-- owa

---
 arch/powerpc/kernel/time.c |    3 +++
 1 file changed, 3 insertions(+)

Index: linux-2.6.23.1-rt11/arch/powerpc/kernel/time.c
===================================================================
--- linux-2.6.23.1-rt11.orig/arch/powerpc/kernel/time.c
+++ linux-2.6.23.1-rt11/arch/powerpc/kernel/time.c
@@ -952,6 +952,9 @@ static int __init init_timebase_clocksou
 	if (__USE_RTC())
 		return -ENODEV;
 
+#ifdef CONFIG_PPC64
+	clocksource_timebase.shift = tb_ticks_per_jiffy / 1000000;
+#endif
 	clocksource_timebase.mult = clocksource_hz2mult(tb_ticks_per_sec,
 					clocksource_timebase.shift);
 	return clocksource_register(&clocksource_timebase);
