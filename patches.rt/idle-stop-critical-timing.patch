Subject: Linux-RT 2.6.24-rt1
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
---
 drivers/acpi/processor_idle.c |    8 ++++++++
 1 file changed, 8 insertions(+)

Index: linux-2.6.24-rt1/drivers/acpi/processor_idle.c
===================================================================
--- linux-2.6.24-rt1.orig/drivers/acpi/processor_idle.c	2008-01-25 15:06:44.000000000 -0500
+++ linux-2.6.24-rt1/drivers/acpi/processor_idle.c	2008-01-25 15:07:16.000000000 -0500
@@ -1347,6 +1347,12 @@ static inline void acpi_idle_update_bm_r
  */
 static inline void acpi_idle_do_entry(struct acpi_processor_cx *cx)
 {
+	/*
+	 * We have irqs disabled here, so stop latency tracing
+	 * at this point and restart it after we return:
+	 */
+	stop_critical_timing();
+
 	if (cx->space_id == ACPI_CSTATE_FFH) {
 		/* Call into architectural FFH based C-state */
 		acpi_processor_ffh_cstate_enter(cx);
@@ -1359,6 +1365,8 @@ static inline void acpi_idle_do_entry(st
 		   gets asserted in time to freeze execution properly. */
 		unused = inl(acpi_gbl_FADT.xpm_timer_block.address);
 	}
+
+	touch_critical_timing();
 }
 
 /**
