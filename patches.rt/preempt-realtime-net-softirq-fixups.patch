Subject: NOHZ: local_softirq_pending with tickless

From: Mikulas Patocka <mikulas@artax.karlin.mff.cuni.cz

On one of my machines with tickless kernel and plip I get messages :

NOHZ: local_softirq_pending 08

always when using plip (on other machine with tickless kernel and plip I 
get no errors). Thebug happens both on 2.6.21 and 2.6.22-rc1

This patch fixes that. Note that plip calls netif_rx neither from hardware 
interrupt nor from ksoftirqd, so there is no one who would wake 
ksoftirqd then. netif_tx calls only 
__raise_softirq_irqoff(NET_RX_SOFTIRQ), which sets softirq bit, but 
doesn't wake ksoftirqd.

Mikulas

Signed-off-by: Mikulas Patocka <mikulas@artax.karlin.mff.cuni.cz

Removed the remaining users of __raise_softirq_irqoff() as well.

	tglx

---
 net/core/dev.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

Index: linux-2.6.22/net/core/dev.c
===================================================================
--- linux-2.6.22.orig/net/core/dev.c	2007-07-24 08:57:33.000000000 +0200
+++ linux-2.6.22/net/core/dev.c	2007-07-24 08:57:34.000000000 +0200
@@ -1185,7 +1185,7 @@ void __netif_rx_schedule(struct net_devi
 		dev->quota += dev->weight;
 	else
 		dev->quota = dev->weight;
-	__raise_softirq_irqoff(NET_RX_SOFTIRQ);
+	raise_softirq_irqoff(NET_RX_SOFTIRQ);
 	local_irq_restore(flags);
 }
 EXPORT_SYMBOL(__netif_rx_schedule);
@@ -2060,7 +2060,7 @@ out:
 
 softnet_break:
 	__get_cpu_var(netdev_rx_stat).time_squeeze++;
-	__raise_softirq_irqoff(NET_RX_SOFTIRQ);
+	raise_softirq_irqoff(NET_RX_SOFTIRQ);
 	goto out;
 }
 
