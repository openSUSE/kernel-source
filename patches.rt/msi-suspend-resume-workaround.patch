---
 drivers/base/power/resume.c |    1 +
 drivers/pci/msi.c           |    4 ++++
 2 files changed, 5 insertions(+)

Index: linux-2.6.22/drivers/base/power/resume.c
===================================================================
--- linux-2.6.22.orig/drivers/base/power/resume.c	2007-07-24 08:56:39.000000000 +0200
+++ linux-2.6.22/drivers/base/power/resume.c	2007-07-24 08:57:02.000000000 +0200
@@ -9,6 +9,7 @@
  */
 
 #include <linux/device.h>
+#include <linux/kallsyms.h>
 #include <linux/resume-trace.h>
 #include "../base.h"
 #include "power.h"
Index: linux-2.6.22/drivers/pci/msi.c
===================================================================
--- linux-2.6.22.orig/drivers/pci/msi.c	2007-07-24 08:56:39.000000000 +0200
+++ linux-2.6.22/drivers/pci/msi.c	2007-07-24 08:57:02.000000000 +0200
@@ -235,6 +235,10 @@ static void __pci_restore_msi_state(stru
 		return;
 
 	entry = get_irq_msi(dev->irq);
+	if (!entry) {
+		WARN_ON(1);
+		return;
+	}
 	pos = entry->msi_attrib.pos;
 
 	pci_intx(dev, 0);		/* disable intx */
