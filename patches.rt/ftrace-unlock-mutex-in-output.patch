Subject: Linux-RT 2.6.25.4-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
From: Steven Rostedt <srostedt@redhat.com>
Subject: ftrace: unlock the mutex on reading failure

If for some reason the start of reading the trace files fails, we never
unlock the trace_types mutex. This patch fixes that.

Signed-off-by: Steven Rostedt <srostedt@redhat.com>
---
 kernel/trace/trace.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

Index: linux-2.6.24.4-rt4/kernel/trace/trace.c
===================================================================
--- linux-2.6.24.4-rt4.orig/kernel/trace/trace.c	2008-05-15 11:08:56.000000000 -0400
+++ linux-2.6.24.4-rt4/kernel/trace/trace.c	2008-05-15 11:08:47.000000000 -0400
@@ -834,8 +834,10 @@ static void *s_start(struct seq_file *m,
 
 	mutex_lock(&trace_types_lock);
 
-	if (!current_trace || current_trace != iter->trace)
+	if (!current_trace || current_trace != iter->trace) {
+		mutex_unlock(&trace_types_lock);
 		return NULL;
+	}
 
 	atomic_inc(&trace_record_cmdline_disabled);
 
