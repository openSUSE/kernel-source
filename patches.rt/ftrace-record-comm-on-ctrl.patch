Subject: Linux-RT 2.6.27-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Tony Jones <tonyj@suse.de>
From: Steven Rostedt <srostedt@redhat.com>
Subject: ftrace: record comm on function ctrl change

On stress tests, it is possible for the comm of that disables the
ftracer to be lost. Record it on turning on or off the function tracer.

Signed-off-by: Steven Rostedt <srostedt@redhat.com>
---
 kernel/trace/trace.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 865097e..d0cc193 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -1252,10 +1252,12 @@ void tracing_start_function_trace(void)
 	register_ftrace_function(&trace_ops);
 	if (tracer_enabled)
 		ftrace_function_enabled = 1;
+	tracing_record_cmdline(current);
 }
 
 void tracing_stop_function_trace(void)
 {
+	tracing_record_cmdline(current);
 	ftrace_function_enabled = 0;
 	unregister_ftrace_function(&trace_ops);
 }
