Subject: Linux-RT 2.6.25.4-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
---
 drivers/net/sungem.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

Index: linux-2.6.25.4-rt1/drivers/net/sungem.c
===================================================================
--- linux-2.6.25.4-rt1.orig/drivers/net/sungem.c	2008-05-17 08:26:43.000000000 -0400
+++ linux-2.6.25.4-rt1/drivers/net/sungem.c	2008-05-17 08:26:59.000000000 -0400
@@ -1033,10 +1033,8 @@ static int gem_start_xmit(struct sk_buff
 			(csum_stuff_off << 21));
 	}
 
-	local_irq_save(flags);
-	if (!spin_trylock(&gp->tx_lock)) {
+	if (!spin_trylock_irqsave(&gp->tx_lock, flags)) {
 		/* Tell upper layer to requeue */
-		local_irq_restore(flags);
 		return NETDEV_TX_LOCKED;
 	}
 	/* We raced with gem_do_stop() */
