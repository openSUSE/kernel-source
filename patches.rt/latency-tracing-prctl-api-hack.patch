 include/linux/prctl.h |    1 +
 include/linux/sched.h |    2 --
 kernel/sys.c          |    8 ++++++++
 3 files changed, 9 insertions(+), 2 deletions(-)

Index: linux-2.6.22/include/linux/prctl.h
===================================================================
--- linux-2.6.22.orig/include/linux/prctl.h	2007-07-24 08:56:34.000000000 +0200
+++ linux-2.6.22/include/linux/prctl.h	2007-07-24 08:57:07.000000000 +0200
@@ -3,6 +3,7 @@
 
 /* Values to pass as first argument to prctl() */
 
+#define PR_SET_TRACING    0  /* Second arg is tracing on/off */
 #define PR_SET_PDEATHSIG  1  /* Second arg is a signal */
 #define PR_GET_PDEATHSIG  2  /* Second arg is a ptr to return the signal */
 
Index: linux-2.6.22/include/linux/sched.h
===================================================================
--- linux-2.6.22.orig/include/linux/sched.h	2007-07-24 08:57:04.000000000 +0200
+++ linux-2.6.22/include/linux/sched.h	2007-07-24 08:57:07.000000000 +0200
@@ -356,8 +356,6 @@ static inline void touch_all_softlockup_
 # define init_tracer()				do { } while (0)
 #endif
 
-extern int timeofday_API_hacks(void *tv, void *tz);
-
 #ifdef CONFIG_WAKEUP_TIMING
   extern int wakeup_timing;
   extern void __trace_start_sched_wakeup(struct task_struct *p);
Index: linux-2.6.22/kernel/sys.c
===================================================================
--- linux-2.6.22.orig/kernel/sys.c	2007-07-24 08:56:34.000000000 +0200
+++ linux-2.6.22/kernel/sys.c	2007-07-24 08:57:07.000000000 +0200
@@ -2149,6 +2149,14 @@ asmlinkage long sys_prctl(int option, un
 {
 	long error;
 
+#ifdef CONFIG_EVENT_TRACE
+	if (option == PR_SET_TRACING) {
+		if (arg2)
+			return user_trace_start();
+		return user_trace_stop();
+	}
+#endif
+
 	error = security_task_prctl(option, arg2, arg3, arg4, arg5);
 	if (error)
 		return error;
