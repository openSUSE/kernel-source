From: Nikanth Karthikesan <knikanth@suse.de>
Subject: loop: Update mtime when writing using aops
Patch-mainline: Probably 2.6.34. Currently in Jens's tree
References: bnc#590738

Date: Thu, 8 Apr 2010 19:39:31 +0000 (+0200)
Subject: loop: Update mtime when writing using aops
X-Git-Url: http://git.kernel.org/?p=linux%2Fkernel%2Fgit%2Faxboe%2Flinux-2.6-block.git;a=commitdiff_plain;h=02246c41171097ceab3246f6dc251ac89de6004b

loop: Update mtime when writing using aops

Update mtime when writing to backing filesystem using the address space
operations write_begin and write_end.

Signed-off-by: Nikanth Karthikesan <knikanth@suse.de>
Signed-off-by: Jens Axboe <jens.axboe@oracle.com>

---

Index: linux-2.6.33-master/drivers/block/loop.c
===================================================================
--- linux-2.6.33-master.orig/drivers/block/loop.c
+++ linux-2.6.33-master/drivers/block/loop.c
@@ -238,6 +238,8 @@ static int do_lo_send_aops(struct loop_d
 		if (ret)
 			goto fail;
 
+		file_update_time(file);
+
 		transfer_result = lo_do_transfer(lo, WRITE, page, offset,
 				bvec->bv_page, bv_offs, size, IV);
 		copied = size;
