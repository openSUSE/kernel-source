From: Olaf Kirch <okir@suse.de>
Subject: NFS: prevent hangs when NFS server returns EJUKEBOX

When an NFS server returns EJUKEBOX, we restart the RPC task, setting
a delay of a few seconds so that the call is retried a little later.
Unfortunately, we will kill the timer immediately afterwards when we
re-enter the main loop in __rpc_execute.

The fix below will kill the timer only when the task is actually
running.

Signed-off-by: okir@suse.de

Index: linux-2.6.10/net/sunrpc/sched.c
===================================================================
--- linux-2.6.10.orig/net/sunrpc/sched.c
+++ linux-2.6.10/net/sunrpc/sched.c
@@ -569,7 +569,8 @@ static int __rpc_execute(struct rpc_task
 		/*
 		 * Garbage collection of pending timers...
 		 */
-		rpc_delete_timer(task);
+		if (RPC_IS_RUNNING(task))
+			rpc_delete_timer(task);
 
 		/*
 		 * Execute any pending callback.
