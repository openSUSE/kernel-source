From: unknown
Subject: don't know.

Signed-off-by: <foo@suse.de>

# note, gregkh added the above, as he modified the patch to apply properly, don't
# assume it is correct...

--- linux-2.6.0-test7/drivers/serial/21285.c.~1~	2003-10-08 21:24:26.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/21285.c	2003-10-14 14:40:01.000000000 +0200
@@ -409,14 +409,14 @@ serial21285_console_write(struct console
 	int i;
 
 	for (i = 0; i < count; i++) {
-		while (*CSR_UARTFLG & 0x20)
-			barrier();
-		*CSR_UARTDR = s[i];
 		if (s[i] == '\n') {
 			while (*CSR_UARTFLG & 0x20)
 				barrier();
 			*CSR_UARTDR = '\r';
 		}
+		while (*CSR_UARTFLG & 0x20)
+			barrier();
+		*CSR_UARTDR = s[i];
 	}
 }
 
--- linux-2.6.0-test7/drivers/serial/68360serial.c.~1~	2003-10-08 21:24:51.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/68360serial.c	2003-10-14 14:53:02.000000000 +0200
@@ -2213,6 +2213,22 @@ static void my_console_write(int idx, co
 	 * buffer, but we would just wait longer between accesses......
 	 */
 	for (i = 0; i < count; i++, s++) {
+		/* if a LF, also do CR... */
+		if (*s == 10) {
+			while (bdp->status & BD_SC_READY);
+			/* cp = __va(bdp->buf); */
+			cp = bdp->buf;
+			*cp = 13;
+			bdp->length = 1;
+			bdp->status |= BD_SC_READY;
+
+			if (bdp->status & BD_SC_WRAP) {
+				bdp = bdbase;
+			}
+			else {
+				bdp++;
+			}
+		}
 		/* Wait for transmitter fifo to empty.
 		 * Ready indicates output is ready, and xmt is doing
 		 * that, not that it is ready for us to send.
@@ -2232,22 +2248,6 @@ static void my_console_write(int idx, co
 		else
 			bdp++;
 
-		/* if a LF, also do CR... */
-		if (*s == 10) {
-			while (bdp->status & BD_SC_READY);
-			/* cp = __va(bdp->buf); */
-			cp = bdp->buf;
-			*cp = 13;
-			bdp->length = 1;
-			bdp->status |= BD_SC_READY;
-
-			if (bdp->status & BD_SC_WRAP) {
-				bdp = bdbase;
-			}
-			else {
-				bdp++;
-			}
-		}
 	}
 
 	/*
--- linux-2.6.0-test7/drivers/serial/8250.c.~1~	2003-10-08 21:24:01.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/8250.c	2003-10-14 14:47:02.000000000 +0200
@@ -1946,17 +1946,16 @@ serial8250_console_write(struct console 
 	 *	Now, do each character
 	 */
 	for (i = 0; i < count; i++, s++) {
-		wait_for_xmitr(up);
-
 		/*
 		 *	Send the character out.
 		 *	If a LF, also do CR...
 		 */
-		serial_out(up, UART_TX, *s);
 		if (*s == 10) {
 			wait_for_xmitr(up);
 			serial_out(up, UART_TX, 13);
 		}
+		wait_for_xmitr(up);
+		serial_out(up, UART_TX, *s);
 	}
 
 	/*
--- linux-2.6.0-test7/drivers/serial/clps711x.c.~1~	2003-10-08 21:24:03.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/clps711x.c	2003-10-14 14:41:02.000000000 +0200
@@ -482,16 +482,16 @@ clps711xuart_console_write(struct consol
 	 *	Now, do each character
 	 */
 	for (i = 0; i < count; i++) {
-		do {
-			status = clps_readl(SYSFLG(port));
-		} while (status & SYSFLG_UTXFF);
-		clps_writel(s[i], UARTDR(port));
 		if (s[i] == '\n') {
 			do {
 				status = clps_readl(SYSFLG(port));
 			} while (status & SYSFLG_UTXFF);
 			clps_writel('\r', UARTDR(port));
 		}
+		do {
+			status = clps_readl(SYSFLG(port));
+		} while (status & SYSFLG_UTXFF);
+		clps_writel(s[i], UARTDR(port));
 	}
 
 	/*
--- linux-2.6.0-test7/drivers/serial/pmac_zilog.c.~1~	2003-10-08 21:24:01.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/pmac_zilog.c	2003-10-14 14:42:46.000000000 +0200
@@ -1538,15 +1538,15 @@ static void pmz_console_write(struct con
 	write_zsreg(uap, R5, uap->curregs[5] | TxENABLE | RTS | DTR);
 
 	for (i = 0; i < count; i++) {
-		/* Wait for the transmit buffer to empty. */
-		while ((read_zsreg(uap, R0) & Tx_BUF_EMP) == 0)
-			udelay(5);
-		write_zsdata(uap, s[i]);
 		if (s[i] == 10) {
 			while ((read_zsreg(uap, R0) & Tx_BUF_EMP) == 0)
 				udelay(5);
 			write_zsdata(uap, R13);
 		}
+		/* Wait for the transmit buffer to empty. */
+		while ((read_zsreg(uap, R0) & Tx_BUF_EMP) == 0)
+			udelay(5);
+		write_zsdata(uap, s[i]);
 	}
 
 	/* Restore the values in the registers. */
--- linux-2.6.0-test7/drivers/serial/sa1100.c.~1~	2003-10-08 21:24:02.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/sa1100.c	2003-10-14 14:41:48.000000000 +0200
@@ -740,16 +740,16 @@ sa1100_console_write(struct console *co,
 	 *	Now, do each character
 	 */
 	for (i = 0; i < count; i++) {
-		do {
-			status = UART_GET_UTSR1(sport);
-		} while (!(status & UTSR1_TNF));
-		UART_PUT_CHAR(sport, s[i]);
 		if (s[i] == '\n') {
 			do {
 				status = UART_GET_UTSR1(sport);
 			} while (!(status & UTSR1_TNF));
 			UART_PUT_CHAR(sport, '\r');
 		}
+		do {
+			status = UART_GET_UTSR1(sport);
+		} while (!(status & UTSR1_TNF));
+		UART_PUT_CHAR(sport, s[i]);
 	}
 
 	/*
--- linux-2.6.0-test7/drivers/serial/sunsu.c.~1~	2003-10-08 21:24:02.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/sunsu.c	2003-10-14 14:45:13.000000000 +0200
@@ -1402,17 +1402,16 @@ static void sunsu_console_write(struct c
 	 *	Now, do each character
 	 */
 	for (i = 0; i < count; i++, s++) {
-		wait_for_xmitr(up);
-
 		/*
 		 *	Send the character out.
 		 *	If a LF, also do CR...
 		 */
-		serial_out(up, UART_TX, *s);
 		if (*s == 10) {
 			wait_for_xmitr(up);
 			serial_out(up, UART_TX, 13);
 		}
+		wait_for_xmitr(up);
+		serial_out(up, UART_TX, *s);
 	}
 
 	/*
--- linux-2.6.0-test7/drivers/serial/sunzilog.c.~1~	2003-10-08 21:24:51.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/sunzilog.c	2003-10-14 14:47:36.000000000 +0200
@@ -1350,9 +1350,9 @@ sunzilog_console_write(struct console *c
 
 	spin_lock_irqsave(&up->port.lock, flags);
 	for (i = 0; i < count; i++, s++) {
-		sunzilog_put_char(channel, *s);
 		if (*s == 10)
 			sunzilog_put_char(channel, 13);
+		sunzilog_put_char(channel, *s);
 	}
 	udelay(2);
 	spin_unlock_irqrestore(&up->port.lock, flags);
--- linux-2.6.0-test7/drivers/serial/uart00.c.~1~	2003-10-08 21:24:04.000000000 +0200
+++ linux-2.6.0-test7/drivers/serial/uart00.c	2003-10-14 14:43:30.000000000 +0200
@@ -553,16 +553,16 @@ static void uart00_console_write(struct 
 	 *	Now, do each character
 	 */
 	for (i = 0; i < count; i++) {
-		do {
-			status = UART_GET_TSR(port);
-		} while (!UART_TX_READY(status));
-		UART_PUT_CHAR(port, s[i]);
 		if (s[i] == '\n') {
 			do {
 				status = UART_GET_TSR(port);
 			} while (!UART_TX_READY(status));
 			UART_PUT_CHAR(port, '\r');
 		}
+		do {
+			status = UART_GET_TSR(port);
+		} while (!UART_TX_READY(status));
+		UART_PUT_CHAR(port, s[i]);
 	}
 
 	/*
