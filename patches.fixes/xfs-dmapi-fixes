From: Bill O'Donnel <billodo@sgi.com>
Subject: xfs/dmapi: fix crash on mount
References: bnc#458027
Patch-mainline: not yet, depends on dmapi

 This patch resolves a crash on mount problem with dmapi, relating to an
 errant search and replace.

Acked-by: Jeff Mahoney <jeffm@suse.com>
---

 fs/dmapi/dmapi_private.h |    4 ++--
 fs/xfs/xfs_dmops.c       |    1 -
 2 files changed, 2 insertions(+), 3 deletions(-)

--- a/fs/dmapi/dmapi_private.h
+++ b/fs/dmapi/dmapi_private.h
@@ -37,8 +37,8 @@
 #include "sv.h"
 
 #ifdef CONFIG_PROC_FS
-#define DMAPI_PROCFS		"orig/fs/dmapi_v2" /* DMAPI device in /proc. */
-#define DMAPI_DBG_PROCFS	"orig/fs/dmapi_d" /* DMAPI debugging dir */
+#define DMAPI_PROCFS		"fs/dmapi_v2" /* DMAPI device in /proc. */
+#define DMAPI_DBG_PROCFS	"fs/dmapi_d" /* DMAPI debugging dir */
 #endif
 
 extern struct kmem_cache	*dm_fsreg_cachep;
--- a/fs/xfs/xfs_dmops.c
+++ b/fs/xfs/xfs_dmops.c
@@ -57,7 +57,6 @@ xfs_dmops_get(struct xfs_mount *mp)
 		mp->m_dm_ops = &xfs_dmcore_stub;
 	}
 
-	mp->m_dm_ops = &xfs_dmcore_stub;
 	return 0;
 }
 
